server:
  port: 8080

# Spring Boot 3.5 vs Spring Cloud 호환 검사 비활성화 (bootRun/Docker 공통)
spring:
  cloud:
    compatibility-verifier:
      enabled: ${SPRING_CLOUD_COMPATIBILITY_VERIFIER_ENABLED:false}
    gateway:
      routes:
        - id: user-service
          uri: ${USER_SERVICE_URI:http://localhost:8081}
          predicates:
            - Path=/users/**,/auth/**
        - id: product-service
          uri: ${PRODUCT_SERVICE_URI:http://localhost:8082}
          predicates:
            - Path=/products/**
        - id: order-service
          uri: ${ORDER_SERVICE_URI:http://localhost:8083}
          predicates:
            - Path=/orders/**,/cart/**
        - id: settlement-service
          uri: ${SETTLEMENT_SERVICE_URI:http://localhost:8085}
          predicates:
            - Path=/settlements/**
        # 통합 Swagger: 각 서비스 /v3/api-docs 프록시 (경로만 교체)
        - id: api-docs-user
          uri: ${USER_SERVICE_URI:http://localhost:8081}
          predicates:
            - Path=/api-docs/user-service
          filters:
            - RewritePath=/api-docs/user-service,/v3/api-docs
        - id: api-docs-product
          uri: ${PRODUCT_SERVICE_URI:http://localhost:8082}
          predicates:
            - Path=/api-docs/product-service
          filters:
            - RewritePath=/api-docs/product-service,/v3/api-docs
        - id: api-docs-order
          uri: ${ORDER_SERVICE_URI:http://localhost:8083}
          predicates:
            - Path=/api-docs/order-service
          filters:
            - RewritePath=/api-docs/order-service,/v3/api-docs
        - id: api-docs-payment
          uri: ${PAYMENT_SERVICE_URI:http://localhost:8084}
          predicates:
            - Path=/api-docs/payment-service
          filters:
            - RewritePath=/api-docs/payment-service,/v3/api-docs
        - id: api-docs-settlement
          uri: ${SETTLEMENT_SERVICE_URI:http://localhost:8085}
          predicates:
            - Path=/api-docs/settlement-service
          filters:
            - RewritePath=/api-docs/settlement-service,/v3/api-docs
  application:
    name: api-gateway

# Actuator + Prometheus + Zipkin 추적
management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus
  endpoint:
    health:
      show-details: when_authorized
  tracing:
    sampling:
      probability: 1.0
  zipkin:
    tracing:
      endpoint: ${ZIPKIN_ENDPOINT:http://localhost:9411/api/v2/spans}

# JWT 검증 (user-service와 동일 secret). prod에서는 APP_JWT_SECRET env 필수.
app:
  jwt:
    secret: ${APP_JWT_SECRET:msa-shop-jwt-secret-key-at-least-32-bytes-long-for-hs256}
  # 정산 API(/settlements/**) JWT 필수 여부. true면 인증 필요(관리자 전용 등).
  settlements:
    auth-required: ${SETTLEMENTS_AUTH_REQUIRED:false}
  # Rate Limit: IP당 분당 요청 수. 초과 시 429. 0이면 비활성화(E2E 권장).
  rate-limit:
    per-minute: ${RATE_LIMIT_PER_MINUTE:120}
