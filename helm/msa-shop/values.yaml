# 기본값. 로컬 테스트·단일 설치용. 운영 시 -f values-prod.yaml 또는 --set 로 오버라이드.
# 이미지: 로컬 빌드 시 msa-shop-*:latest, 레지스트리 사용 시 your-registry/msa-shop-*:tag
global:
  imagePullPolicy: IfNotPresent
  # 비공개 레지스트리 사용 시 시크릿 이름 (values-prod 등에서 설정)
  # imagePullSecrets: regcred
# 앱 공통 리소스 기본값. 서비스별로 오버라이드 가능.
defaultResources:
  requests:
    memory: "256Mi"
    cpu: "100m"
  limits:
    memory: "512Mi"
    cpu: "500m"

secrets:
  mysqlRootPassword: "root"
  jwtSecret: "msa-shop-jwt-secret-key-at-least-32-bytes-long-for-hs256"
  rabbitmqUsername: "guest"
  rabbitmqPassword: "guest"

mysql:
  image: mysql:8
  persistence:
    size: 1Gi
  # MySQL 8은 기본 메모리 사용이 커서, 로컬(Docker Desktop 등)에서는 512Mi 제한 시 OOMKilled 발생 가능. 1Gi 권장.
  resources:
    requests:
      memory: "512Mi"
      cpu: "100m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

rabbitmq:
  image: rabbitmq:3-management
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

redis:
  enabled: false  # true로 하면 Redis 배포 + product-service 캐시 사용. false면 가벼운 기본 설치.
  image: redis:7-alpine

apiGateway:
  replicas: 1
  resources: {}  # 비우면 global defaultResources 사용 (템플릿에서 fallback)
  # /settlements/** JWT 인증 필수 여부. true면 관리자(인증 사용자)만 정산 API 호출 가능.
  settlementsAuthRequired: false
  image:
    repository: msa-shop-api-gateway
    tag: latest

userService:
  replicas: 1
  resources: {}
  image:
    repository: msa-shop-user-service
    tag: latest

productService:
  replicas: 1
  resources: {}
  image:
    repository: msa-shop-product-service
    tag: latest

orderService:
  replicas: 1
  resources: {}
  hpa:
    enabled: true
    minReplicas: 1
    maxReplicas: 3
    targetCPUUtilizationPercentage: 70
  image:
    repository: msa-shop-order-service
    tag: latest

paymentService:
  replicas: 1
  resources: {}
  image:
    repository: msa-shop-payment-service
    tag: latest

settlementService:
  replicas: 1
  resources: {}
  image:
    repository: msa-shop-settlement-service
    tag: latest

ingress:
  enabled: true
  className: nginx
  # host: msa-shop.local  # 운영 시 설정

# 관측성 (Prometheus, Grafana, Zipkin). 기본 비활성화로 가벼운 설치. 필요 시 true.
observability:
  enabled: false
  prometheus:
    image: prom/prometheus:latest
    retention: 15d
  grafana:
    image: grafana/grafana:latest
    adminUser: admin
    adminPassword: admin
  zipkin:
    image: openzipkin/zipkin:latest
    # 로컬 클러스터(Docker Desktop 등)에서 limits 없으면 OOMKilled 발생 가능. template에 512Mi 기본 적용.
